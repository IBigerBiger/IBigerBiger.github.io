<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="性能优化," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="关于性能优化，这是一个经常会被忽视的问题，但是对于一个程序员的成长，对于性能优化是一个必不可少的过程，对于性能优化也会提升我们代码习惯与代码质量，同样也会更多掌握谷歌提供的性能相关工具
性能优化一般从渲染，运算，内存，电量四个方面进行，当然我这里会展开更多的方面去做讲解
这一篇主要是针对于布局优化的，所以我们要先了解Android的渲染机制
渲染机制我们知道Android系统每隔16ms就重新绘制">
<meta property="og:type" content="article">
<meta property="og:title" content="Android性能优化(一)-布局优化">
<meta property="og:url" content="http://yoursite.com/2016/10/03/Android性能优化(一)-布局优化/index.html">
<meta property="og:site_name" content="IBigerBiger的成长之路">
<meta property="og:description" content="关于性能优化，这是一个经常会被忽视的问题，但是对于一个程序员的成长，对于性能优化是一个必不可少的过程，对于性能优化也会提升我们代码习惯与代码质量，同样也会更多掌握谷歌提供的性能相关工具
性能优化一般从渲染，运算，内存，电量四个方面进行，当然我这里会展开更多的方面去做讲解
这一篇主要是针对于布局优化的，所以我们要先了解Android的渲染机制
渲染机制我们知道Android系统每隔16ms就重新绘制">
<meta property="og:image" content="http://p1.bpimg.com/567571/cf46608bc3cd14f6.png">
<meta property="og:image" content="http://i1.piimg.com/567571/9565cf179d2881dd.png">
<meta property="og:image" content="http://p1.bqimg.com/567571/8b36f766da87001d.png">
<meta property="og:image" content="http://i1.piimg.com/567571/d071314b5796be5f.png">
<meta property="og:image" content="http://i1.piimg.com/567571/5913c32227de4aa9.png">
<meta property="og:image" content="http://p1.bpimg.com/567571/45cbb9f0410d5699.png">
<meta property="og:image" content="http://p1.bqimg.com/567571/3688497b35cae622.png">
<meta property="og:image" content="http://i1.piimg.com/567571/e27d3a85ca320181.png">
<meta property="og:image" content="http://p1.bqimg.com/567571/0c965b5fb4dc6a76.png">
<meta property="og:image" content="http://p1.bqimg.com/567571/3fbcfd131eba7f1c.png">
<meta property="og:image" content="http://i1.piimg.com/567571/fe66edf3ec38608a.png">
<meta property="og:image" content="http://p1.bqimg.com/567571/2f5830a944ecc8d7.png">
<meta property="og:image" content="http://p1.bqimg.com/567571/8bf84cf817b224fc.png">
<meta property="og:image" content="http://i1.piimg.com/567571/dd42bdde87b968cb.png">
<meta property="og:updated_time" content="2017-03-25T07:58:58.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android性能优化(一)-布局优化">
<meta name="twitter:description" content="关于性能优化，这是一个经常会被忽视的问题，但是对于一个程序员的成长，对于性能优化是一个必不可少的过程，对于性能优化也会提升我们代码习惯与代码质量，同样也会更多掌握谷歌提供的性能相关工具
性能优化一般从渲染，运算，内存，电量四个方面进行，当然我这里会展开更多的方面去做讲解
这一篇主要是针对于布局优化的，所以我们要先了解Android的渲染机制
渲染机制我们知道Android系统每隔16ms就重新绘制">
<meta name="twitter:image" content="http://p1.bpimg.com/567571/cf46608bc3cd14f6.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2016/10/03/Android性能优化(一)-布局优化/"/>





  <title> Android性能优化(一)-布局优化 | IBigerBiger的成长之路 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">IBigerBiger</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/03/Android性能优化(一)-布局优化/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="IBigerBiger">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="IBigerBiger的成长之路">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="IBigerBiger的成长之路" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Android性能优化(一)-布局优化
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-03T19:47:53+08:00">
                2016-10-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/10/03/Android性能优化(一)-布局优化/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/03/Android性能优化(一)-布局优化/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>关于性能优化，这是一个经常会被忽视的问题，但是对于一个程序员的成长，对于性能优化是一个必不可少的过程，对于性能优化也会提升我们代码习惯与代码质量，同样也会更多掌握谷歌提供的性能相关工具</p>
<p>性能优化一般从渲染，运算，内存，电量四个方面进行，当然我这里会展开更多的方面去做讲解</p>
<p>这一篇主要是针对于布局优化的，所以我们要先了解Android的渲染机制</p>
<h4 id="渲染机制"><a href="#渲染机制" class="headerlink" title="渲染机制"></a>渲染机制</h4><p>我们知道Android系统每隔16ms就重新绘制一次界面，也就是说，每一帧只能停留16ms，所以尽量保证每次在16ms内处理完所有的CPU与GPU计算、绘制、渲染等操作，否则会造成丢帧卡顿问题。</p>
<p>16ms意味着1000/60hz，相当于60fps。人类大脑与眼睛对一个画面的连贯性感知其实是有一个界限的。12fps大概类似手动快速翻动书籍的帧率， 这明显是可以感知到不够顺滑的。24fps使得人眼感知的是连续线性的运动，这其实是归功于运动模糊的效果。 24fps是电影胶圈通常使用的帧率，因为这个帧率已经足够支撑大部分电影画面需要表达的内容，同时能够最大的减少费用支出。 但是低于30fps是 无法顺畅表现绚丽的画面内容的，此时就需要用到60fps来达到想要的效果，超过60fps就没有必要了。如果我们的应用没有在16ms内完成屏幕刷新的全部逻辑操作，就会发生卡顿。</p>
<p>正常情况下Android的渲染机制如下</p>
<p>Android系统每隔16ms发出VSYNC信号，触发对UI进行渲染，VSync是Vertical Synchronization(垂直同步)的缩写，是一种在PC上很早就广泛使用的技术，可以简单的把它认为是一种定时中断。而在Android 4.1(JB)中已经开始引入VSync机制。</p>
<a id="more"></a>
<div align="center"><br><img src="http://p1.bpimg.com/567571/cf46608bc3cd14f6.png" alt=""><br></div>

<p>可以看到正常情况下在16ms内完成了所有操作，那么整个过程如果保证在16ms以内就能达到一个流畅的画面。</p>
<p>如果操作超过了16ms就会发生下面的情况：</p>
<div align="center"><br><img src="http://i1.piimg.com/567571/9565cf179d2881dd.png" alt=""><br></div>

<p>可以看到当16ms时候VSYNC发出了，而我们的还在进行相关的操作，这时候不会触发重绘，而是在下一次VSYNC发出的时候才会进行重新绘制，那么这样其实就是32ms才进行一次刷新了，这已经超出了人类大脑与眼睛对一个画面的连贯性感知的界限，所以用户就会发现卡顿的现象</p>
<p>接下来看一下这16秒内做了什么，知道做了什么就可以想出对了的优化方法</p>
<p>渲染操作通常依赖于两个核心组件：CPU与GPU。CPU负责包括Measure，Layout，Record，Execute的计算操作，GPU 负责Rasterization(栅格化)操作。</p>
<div align="center"><br><img src="http://p1.bqimg.com/567571/8b36f766da87001d.png" alt=""><br></div>

<p>Resterization栅格化是绘制那些Button，Shape，Path，String，Bitmap等组件最基础的操作。它把那些组件拆分到不同的像素上进行显示。这是一个很费时的操作，GPU的引入就是为了加快栅格化的操作。</p>
<p>CPU负责把UI组件计算成Polygons，Texture纹理，然后交给GPU进行栅格化渲染。</p>
<div align="center"><br><img src="http://i1.piimg.com/567571/d071314b5796be5f.png" alt=""><br></div>

<p>然而每次从CPU转移到GPU是一件很麻烦的事情，所幸的是OpenGL ES可以把那些需要渲染的纹理Hold在GPU Memory里面，在下次需要渲染的时候直接进行操作。所以如果你更新了GPU所hold住的纹理内容，那么之前保存的状态就丢失了。</p>
<p>下面一张图很好的展示出了CPU和GPU的工作，以及潜在的问题，检测的工具和解决方案。</p>
<div align="center"><br><img src="http://i1.piimg.com/567571/5913c32227de4aa9.png" alt=""><br></div>

<p>通过上图可以看到</p>
<ul>
<li>CPU产生的问题：不必要的布局和失效</li>
<li>GPU产生的问题：过度绘制（overdraw）</li>
</ul>
<p>那么接下来就是解决这些问题了，对于这些问题首先是我们需要去通过工具确定问题所在</p>
<h4 id="检测工具"><a href="#检测工具" class="headerlink" title="检测工具"></a>检测工具</h4><h5 id="1-过度绘制（overdraw）检测"><a href="#1-过度绘制（overdraw）检测" class="headerlink" title="1.过度绘制（overdraw）检测"></a>1.过度绘制（overdraw）检测</h5><p>Overdraw(过度绘制)描述的是屏幕上的某个像素在同一帧的时间内被绘制了多次。在多层次的UI结构里面， 如果不可见的UI也在做绘制的操作，这就会导致某些像素区域被绘制了多次。这就浪费大量的CPU以及GPU资源。</p>
<p>按照以下步骤打开Show GPU Overrdraw的选项：</p>
<p>设置 -&gt; 开发者选项 -&gt; 调试GPU过度绘制 -&gt; 显示GPU过度绘制</p>
<p>好了，打开以后呢，你会发现屏幕上有各种颜色，此时你可以切换到需要检测的程序，对于各个色块，对比一张Overdraw的参考图：</p>
<div align="center"><br><img src="http://p1.bpimg.com/567571/45cbb9f0410d5699.png" alt=""><br></div>

<p>蓝色，淡绿，淡红，深红代表了4种不同程度的Overdraw情况，</p>
<ul>
<li><p>蓝色： 意味着overdraw 1倍。像素绘制了两次。大片的蓝色还是可以接受的（若整个窗口是蓝色的，可以摆脱一层）。</p>
</li>
<li><p>绿色： 意味着overdraw 2倍。像素绘制了三次。中等大小的绿色区域是可以接受的但你应该尝试优化、减少它们。</p>
</li>
<li><p>淡红： 意味着overdraw 3倍。像素绘制了四次，小范围可以接受。</p>
</li>
<li><p>深红： 意味着overdraw 4倍。像素绘制了五次或者更多。这是错误的，要修复它们。</p>
</li>
</ul>
<p>我们的目标就是尽量减少红色Overdraw，看到更多的蓝色区域。</p>
<h5 id="2-Hierarchy-Viewer工具"><a href="#2-Hierarchy-Viewer工具" class="headerlink" title="2.Hierarchy Viewer工具"></a>2.Hierarchy Viewer工具</h5><p>Hierarchy Viewer工具提供了一个可视化界面显示布局的层次结构，让我们可以进行调试，从而优化界面布局结构。</p>
<p>打开Hierarchy Viewer有两种方式</p>
<p>第一种直接在 sdk&gt;tools 下面找到 hierarchyviewer.bat 双击运行。</p>
<p>但是出现这个提示：</p>
<p>The standalone version of hieararchyviewer is deprecated.Please use Android Device Monitor (tools/monitor.bat) instead.</p>
<p>大概意思是说，单独版本的hieararchyviewer已经被弃用了。请使用Android Device Monitor来代替。</p>
<p>所以这里我们用第二种方式通过Android Device Monitor来使用hieararchyviewer，其实只是后面的版本将hierarchyviewer整合到了Android Device Monitor里面了而已</p>
<p>打开流程如下图</p>
<div align="center"><br><img src="http://p1.bqimg.com/567571/3688497b35cae622.png" alt=""><br></div>

<p>启动 Android Device Monitor 成功之后，在新的的窗口中点击切换视图图标，选择 Hierarchy Viewe ，如下图：</p>
<div align="center"><br><img src="http://i1.piimg.com/567571/e27d3a85ca320181.png" alt=""><br></div>

<p>如果你是用的模拟器或者开发版手机的话则可以直接进行连接调试了，如果不是的话，官方提供了两种方式，进行连接真机调试：</p>
<p>1.通过第三方库，安装和配置<a href="https://github.com/romainguy/ViewServer" target="_blank" rel="external">ViewServer</a>，配置步骤比较简单，主要分为如下三步：</p>
<ul>
<li><p>添加依赖，外层build.gradle文件，添加工具远程仓库地址；内层build.gradle文件，添加依赖：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">	//外层build.gradle</div><div class="line">	allprojects &#123;  </div><div class="line">   repositories &#123;  </div><div class="line">       jcenter()  </div><div class="line">       maven &#123; url &quot;https://jitpack.io&quot; &#125;  </div><div class="line">   	&#125;  </div><div class="line">&#125; </div><div class="line"></div><div class="line">//内层build.gradle</div><div class="line">dependencies &#123;</div><div class="line">   ...................................</div><div class="line">   compile &apos;com.github.romainguy:ViewServer:017c01cd512cac3ec054d9eee05fc48c5a9d2de&apos;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>在manifest文件申请网络权限</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>在调试的Activity以下该三个方法中添加几行代码</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">	public void onCreate(Bundle savedInstanceState) &#123;  </div><div class="line">   	super.onCreate(savedInstanceState);  </div><div class="line">   	// Set content view, etc.  </div><div class="line">   	ViewServer.get(this).addWindow(this);  </div><div class="line">&#125; </div><div class="line"></div><div class="line">public void onDestroy() &#123;  </div><div class="line">   	super.onDestroy();  </div><div class="line">   	ViewServer.get(this).removeWindow(this);  </div><div class="line">&#125;		</div><div class="line">	</div><div class="line">	public void onResume() &#123;  </div><div class="line">   	super.onResume();  </div><div class="line">   	ViewServer.get(this).setFocusedWindow(this);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.只需在环境变量添加这句话（以Mac系统为例），然后启动HierarchyViewer即可：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export ANDROID_HVPROTO=ddm</div></pre></td></tr></table></figure>
<p> 这样设置的原理是，让HV使用与ddms相同的协议来连接设备。也就是说，为了运行HV，需要杀掉其他ddms会话进程。</p>
<p> 但是网上有反馈说部分机型不适用，所以还是选择第一种方法比较靠谱些。</p>
</li>
</ul>
<p>当可以连接调试后，选择一个节点，点击右上角的<img src="http://p1.bqimg.com/567571/0c965b5fb4dc6a76.png" alt="">按钮，就可以获取到布局绘制的时间，如下所示</p>
<div align="center"><br><img src="http://p1.bqimg.com/567571/3fbcfd131eba7f1c.png" alt=""><br></div>

<p>这里我们主要关注下面的三个圆圈，从左到右依次，代表View的Measure, Layout和Draw的性能，不同颜色代表不同的性能等级：</p>
<ul>
<li><p>绿: 表示该View的此项性能比该View Tree中超过50%的View都要快；例如,一个绿点的测量时间意味着这个视图的测量时间快于树中的视图对象的50%。</p>
</li>
<li><p>黄: 表示该View的此项性能比该View Tree中超过50%的View都要慢；例如,一个黄点布局意味着这种观点有较慢的布局时间超过50%的树视图对象。</p>
</li>
<li><p>红: 表示该View的此项性能是View Tree中最慢的；例如,一个红点的绘制时间意味着花费时间最多的这一观点在树上画所有的视图对象。</p>
</li>
</ul>
<p>如果你发现某个View上的圈是红色，那么说明这个View相对其他的View，该操作运行最慢，注意只是相对别的View，并不是说就一定很慢。</p>
<h4 id="布局优化"><a href="#布局优化" class="headerlink" title="布局优化"></a>布局优化</h4><h5 id="一-布局的抉择"><a href="#一-布局的抉择" class="headerlink" title="一.布局的抉择"></a>一.布局的抉择</h5><p>在开发中，我们一般最常用的布局是RelativeLayout和LinearLayout</p>
<p>那么首先我们需要了解下关于RelativeLayout与LinearLayout的性能开销问题，这个网上已经有开发者做出了相对的分析过程了，那么我就不重复造轮子了，那么这里直接贴上来对比结果与结论</p>
<p>相同效果不同布局的性能对比</p>
<p>LinearLayout</p>
<p>Measure：0.738ms<br>Layout：0.176ms<br>draw：7.655ms</p>
<p>RelativeLayout</p>
<p>Measure：2.280ms<br>Layout：0.153ms<br>draw：7.696ms</p>
<p>对比结论：</p>
<p><strong>RelativeLayout比LinearLayout性能消耗更大，原因在于RelativeLayout会让子View调用2次onMeasure，LinearLayout则是只有在某个子View有weight时，会让该子View调用2次onMeasure。</strong></p>
<p>所以是不是我们选择用LinearLayout而不选择RelativeLayout就可以提升性能呢？</p>
<p>答案当然是否定的，因为使用LinearLayout可能会导致层级的加重，对于嵌套的层级越深，那么布局其实是相对来说更加复杂的，自然用于onMeasure，onLayout与onDraw的时间就会更长，所以这样其实性能反而并没有提升。</p>
<p>所以对于布局的抉择其实是根据实际情况来做选择的，我这里仅仅提出几点需要注意的点</p>
<ul>
<li><p>尽量不要在嵌套的LinearLayout中都使用weight属性，这样会使所有的子View都会进行2次onMeasure，导致性能下降。</p>
</li>
<li><p>RelativeLayout的子View如果高度和RelativeLayout不同，则会引发效率问题，当子View很复杂时，这个问题会更加严重。如果可以，尽量使用padding代替margin。（这个也是来自性能对比结论之一）</p>
</li>
<li><p>在不影响View树层级的前提下，尽量用LinearLayout去替代RelativeLayout，当然使用LinearLayout也要注意第一点。</p>
</li>
<li><p>当布局使用两个LinearLayout时候，可以考虑使用一个RelativeLayout去替代，在时间上此时RelativeLayout耗时要比两个LinearLayout小。</p>
</li>
<li><p>当使用Hierarchy Viewer查看发现布局的层级超过5层时候, 真的就需要考虑优化下布局了</p>
</li>
</ul>
<h5 id="二-减少View"><a href="#二-减少View" class="headerlink" title="二.减少View"></a>二.减少View</h5><p>举个简单例子：</p>
<p>在布局中Icon+文字组成一个视觉上的元素是非常普遍的需求，或者是成为一个可点击的整体，或者是展示某种信息。这种需求实现起来也是非常的简单，初学安卓的同学也能很快的写出来，一个ImageView加上一个TextView，外面再包一层LinearLayout或者RelativeLayout。这需要三个View对象，一个外层group，一个ImageView一个TextView。那么我们有没有更好的解决方案呢？</p>
<p>其实仅仅用一个TextView就可以实现上面的效果</p>
<p>TextView的drawable属性</p>
<p>TextView有一些属性可以在Text的四周设置一个drawable对象，图片,shape等合法的drawable都可以用。</p>
<ul>
<li>drawableStart API 14才有</li>
<li>drawableLeft</li>
<li>drawableTop</li>
<li>drawableBottom</li>
<li>drawableRight</li>
<li>drawableEnd API 14才有</li>
<li>drawablePadding 用以设置drawable与text之间的空间</li>
</ul>
<p>它们的含义就像其名字所暗示的那样，left/top/right/bottom就是在文字的上下左右放置drawable。而drawableStart和drawableEnd则有特殊的意义，虽然它们是API 14加上去的，但是要在API 17后才能真正的生效，它们的作用是当语言方向发生变化时，会换边，LTR语言drawableStart在左边，而drawableEnd在右边；但对于RTL语言来说就会反过来drawableStart在右，drawableEnd在左。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;TextView</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;wrap_content&quot;</div><div class="line">    android:drawableStart=&quot;@drawable/ic_launcher&quot;</div><div class="line">    android:drawableLeft=&quot;@drawable/ic_launcher&quot;</div><div class="line">    android:textSize=&quot;16sp&quot;</div><div class="line">    android:paddingTop=&quot;10dp&quot;</div><div class="line">    android:paddingBottom=&quot;10dp&quot;</div><div class="line">    android:paddingLeft=&quot;10dp&quot;</div><div class="line">    android:gravity=&quot;center&quot;</div><div class="line">    android:drawablePadding=&quot;5dp&quot;</div><div class="line">    android:text=&quot;Text along with Image&quot;</div><div class="line">    /&gt;</div></pre></td></tr></table></figure>
<p>设置效果如下</p>
<div align="center"><br><img src="http://i1.piimg.com/567571/fe66edf3ec38608a.png" alt=""><br></div>

<p>当然这种方式也有可能并不能满足我们的需求，这就需要开发者时刻注意开发过程中的细节，用极客的态度时时刻刻想着怎么去降低层级，减少View。</p>
<h5 id="三-移除不必要的背景"><a href="#三-移除不必要的背景" class="headerlink" title="三.移除不必要的背景"></a>三.移除不必要的背景</h5><p>通过一个例子(来源Google性能优化)来说明，我们来实现一个列表</p>
<p>mian布局</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;LinearLayout </div><div class="line">		xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;match_parent&quot;</div><div class="line">        android:paddingLeft=&quot;@dimen/activity_horizontal_margin&quot;</div><div class="line">        android:paddingRight=&quot;@dimen/activity_horizontal_margin&quot;</div><div class="line">        android:background=&quot;@android:color/white&quot;</div><div class="line">        android:paddingTop=&quot;@dimen/activity_vertical_margin&quot;</div><div class="line">        android:paddingBottom=&quot;@dimen/activity_vertical_margin&quot;</div><div class="line">        android:orientation=&quot;vertical&quot;</div><div class="line">    &gt;</div><div class="line"></div><div class="line">    &lt;TextView</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:padding=&quot;@dimen/narrow_space&quot;</div><div class="line">        android:textSize=&quot;@dimen/large_text_size&quot;</div><div class="line">        android:layout_marginBottom=&quot;@dimen/wide_space&quot;</div><div class="line">        android:text=&quot;@string/header_text&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;ListView</div><div class="line">        android:id=&quot;@+id/id_listview_chats&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:background=&quot;@android:color/white&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:divider=&quot;@android:color/transparent&quot;</div><div class="line">        android:dividerHeight=&quot;@dimen/divider_height&quot;/&gt;</div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<p>item布局</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    android:orientation=&quot;horizontal&quot;</div><div class="line">    android:paddingBottom=&quot;@dimen/chat_padding_bottom&quot;&gt;</div><div class="line"></div><div class="line">    &lt;ImageView</div><div class="line">        android:id=&quot;@+id/id_chat_icon&quot;</div><div class="line">        android:layout_width=&quot;@dimen/avatar_dimen&quot;</div><div class="line">        android:layout_height=&quot;@dimen/avatar_dimen&quot;</div><div class="line">        android:src=&quot;@drawable/joanna&quot;</div><div class="line">        android:layout_margin=&quot;@dimen/avatar_layout_margin&quot; /&gt;</div><div class="line"></div><div class="line">    &lt;LinearLayout</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:background=&quot;@android:color/darker_gray&quot;</div><div class="line">        android:orientation=&quot;vertical&quot;&gt;</div><div class="line"></div><div class="line">        &lt;RelativeLayout</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:background=&quot;@android:color/white&quot;</div><div class="line">            android:textColor=&quot;#78A&quot;</div><div class="line">            android:orientation=&quot;horizontal&quot;&gt;</div><div class="line"></div><div class="line">            &lt;TextView xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">                android:layout_width=&quot;wrap_content&quot;</div><div class="line">                android:layout_height=&quot;wrap_content&quot;</div><div class="line">                android:layout_alignParentLeft=&quot;true&quot;</div><div class="line">                android:padding=&quot;@dimen/narrow_space&quot;</div><div class="line">                android:text=&quot;@string/hello_world&quot;</div><div class="line">                android:gravity=&quot;bottom&quot;</div><div class="line">                android:id=&quot;@+id/id_chat_name&quot; /&gt;</div><div class="line"></div><div class="line">            &lt;TextView xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">                android:layout_width=&quot;wrap_content&quot;</div><div class="line">                android:layout_height=&quot;wrap_content&quot;</div><div class="line">                android:layout_alignParentRight=&quot;true&quot;</div><div class="line">                android:textStyle=&quot;italic&quot;</div><div class="line">                android:text=&quot;@string/hello_world&quot;</div><div class="line">                android:padding=&quot;@dimen/narrow_space&quot;</div><div class="line">                android:id=&quot;@+id/id_chat_date&quot; /&gt;</div><div class="line">        &lt;/RelativeLayout&gt;</div><div class="line"></div><div class="line">        &lt;TextView xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">            android:layout_width=&quot;match_parent&quot;</div><div class="line">            android:layout_height=&quot;match_parent&quot;</div><div class="line">            android:padding=&quot;@dimen/narrow_space&quot;</div><div class="line">            android:background=&quot;@android:color/white&quot;</div><div class="line">            android:text=&quot;@string/hello_world&quot;</div><div class="line">            android:id=&quot;@+id/id_chat_msg&quot; /&gt;</div><div class="line">    &lt;/LinearLayout&gt;</div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<p>运行后效果如下</p>
<div align="center"><br><img src="http://p1.bqimg.com/567571/2f5830a944ecc8d7.png" alt=""><br></div>

<p>我们从布局看层级不深，应该是没有什么问题的吧，但是我们打开Show GPU Overrdraw的时候，惊呆了</p>
<div align="center"><br><img src="http://p1.bqimg.com/567571/8bf84cf817b224fc.png" alt=""><br></div>

<p>Overrdraw的情况特别严重，一个简单的列表展示Item，竟然很多地方被过度绘制了4X，那么为什么呢？明明布局的层级不深，其实主要原因是由于该布局文件中存在很多不必要的背景，多一层背景就会多一次的Overdraw，带来绘制性能损耗。</p>
<p>那么这里分析上述的布局文件，移除没有必要的背景。</p>
<ul>
<li><p>不必要的Background 1</p>
<p>  我们主布局的文件已经是background为white了，那么可以移除ListView的白色背景</p>
</li>
<li><p>不必要的Background 2</p>
<p>  Item布局中的LinearLayout的android:background=”@android:color/darker_gray”</p>
</li>
<li><p>不必要的Background 3</p>
<p>  Item布局中的RelativeLayout的android:background=”@android:color/white”</p>
</li>
<li><p>不必要的Background 4</p>
<p>  Item布局中id为id_msg的TextView的android:background=”@android:color/white”</p>
</li>
</ul>
<p>除了这些地方以外呢？其实还有一个很容易被忽视的地方</p>
<p>当我们使用了Android自带的一些主题时，window会被默认添加一个纯色的背景，这个背景是被DecorView持有的。当我们的自定义布局时又添加了一张背景图或者设置背景色，那么DecorView的background此时对我们来说是无用的，但是它会产生一次Overdraw，带来绘制性能损耗。去掉window的背景可以在onCreate()中setContentView()之后调用getWindow().setBackgroundDrawable(null);或者在theme中添加android:windowbackground=”null”；</p>
<p>经过这五个地方的设置我们看下优化后的Overdraw情况</p>
<div align="center"><br><img src="http://i1.piimg.com/567571/dd42bdde87b968cb.png" alt=""><br></div>

<p>这样其实是到达一个比较好的情况，Overdraw情况良好。</p>
<p>我们在开发过程中的一些习惯性思维定式会带来不经意的Overdraw，所以开发过程中我们为某个View或者ViewGroup设置背景的时候，先思考下是否真的有必要，或者思考下这个背景能不能分段设置在子View上，而不是图方便直接设置在根View上。</p>
<h5 id="四-善于使用布局标签"><a href="#四-善于使用布局标签" class="headerlink" title="四.善于使用布局标签"></a>四.善于使用布局标签</h5><h6 id="1-include标签"><a href="#1-include标签" class="headerlink" title="1.include标签"></a>1.include标签</h6><p>include标签常用于将布局中的公共部分提取出来供其他layout共用，以实现布局模块化，这在布局编写方便提供了大大的便利。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:orientation=&quot;vertical&quot; </div><div class="line">    android:layout_width=”match_parent”</div><div class="line">    android:layout_height=”match_parent”</div><div class="line">    android:background=&quot;@color/app_bg&quot;</div><div class="line">    android:gravity=&quot;center_horizontal&quot;&gt;</div><div class="line"></div><div class="line">    &lt;include layout=&quot;@layout/titlebar&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;TextView android:layout_width=”match_parent”</div><div class="line">              android:layout_height=&quot;wrap_content&quot;</div><div class="line">              android:text=&quot;@string/hello&quot;</div><div class="line">              android:padding=&quot;10dp&quot; /&gt;</div><div class="line"></div><div class="line">    ...</div><div class="line"></div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<h6 id="2-merge标签"><a href="#2-merge标签" class="headerlink" title="2.merge标签"></a>2.merge标签</h6><p>merge标签在UI的结构优化中起着非常重要的作用，它可以删减多余的层级，优化UI。merge多用于替换FrameLayout或者当一个布局包含另一个时，merge标签消除视图层次结构中多余的视图组。例如你的主布局文件是垂直布局，引入了一个垂直布局的include，这是如果include布局使用的LinearLayout就没意义了，使用的话反而减慢你的UI表现。这时可以使用merge标签优化。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&lt;merge xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;  </div><div class="line">  </div><div class="line">    &lt;Button  </div><div class="line">        android:layout_width=&quot;fill_parent&quot;   </div><div class="line">        android:layout_height=&quot;wrap_content&quot;  </div><div class="line">        android:text=&quot;@string/add&quot;/&gt;  </div><div class="line">  </div><div class="line">    &lt;Button  </div><div class="line">        android:layout_width=&quot;fill_parent&quot;   </div><div class="line">        android:layout_height=&quot;wrap_content&quot;  </div><div class="line">        android:text=&quot;@string/delete&quot;/&gt;  </div><div class="line">  </div><div class="line">&lt;/merge&gt;</div></pre></td></tr></table></figure>
<h6 id="3-ViewStub标签"><a href="#3-ViewStub标签" class="headerlink" title="3.ViewStub标签"></a>3.ViewStub标签</h6><p>viewstub标签同include标签一样可以用来引入一个外部布局，不同的是，viewstub引入的布局默认不会扩张，即既不会占用显示也不会占用位置，从而在解析layout时节省cpu和内存。<br>viewstub常用来引入那些默认不会显示，只在特殊情况下显示的布局，如进度布局、网络失败显示的刷新布局、信息出错出现的提示布局等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;ViewStub  </div><div class="line">    android:id=&quot;@+id/stub_import&quot;  </div><div class="line">    android:inflatedId=&quot;@+id/panel_import&quot;  </div><div class="line">    android:layout=&quot;@layout/progress_overlay&quot;  </div><div class="line">    android:layout_width=&quot;fill_parent&quot;  </div><div class="line">    android:layout_height=&quot;wrap_content&quot;  </div><div class="line">    android:layout_gravity=&quot;bottom&quot; /&gt;</div></pre></td></tr></table></figure>
<p>当你想加载布局时，可以使用下面其中一种方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">((ViewStub) findViewById(R.id.stub_import)).setVisibility(View.VISIBLE);  </div><div class="line">// or  </div><div class="line">View importPanel = ((ViewStub) findViewById(R.id.stub_import)).inflate();</div></pre></td></tr></table></figure>
<p>当调用inflate()函数的时候，ViewStub被引用的资源替代，并且返回引用的view。这样程序可以直接得到引用的view而不用再次调用函数findViewById()来查找了。</p>
<p>当然除了上述的几个优化方式，其实在我们布局的时候还有很多可以注意的点，就不做更多的介绍了。</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/性能优化/" rel="tag"># 性能优化</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/05/21/ItemTouchHelper使用与源码简析/" rel="next" title="ItemTouchHelper使用与源码简析">
                <i class="fa fa-chevron-left"></i> ItemTouchHelper使用与源码简析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/10/12/Android性能优化(二)-自定义View优化/" rel="prev" title="Android性能优化(二)-自定义View优化">
                Android性能优化(二)-自定义View优化 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          

    <!-- 多说评论框 start -->
       <div class="ds-thread" data-thread-key="<%- page.path %>" data-title="<%- page.title %>" data-url="<%- page.permalink %>"></div>  
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"ibigerbiger"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->




        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="IBigerBiger" />
          <p class="site-author-name" itemprop="name">IBigerBiger</p>
          <p class="site-description motion-element" itemprop="description">IBigerBiger的成长之路</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#渲染机制"><span class="nav-number">1.</span> <span class="nav-text">渲染机制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#检测工具"><span class="nav-number">2.</span> <span class="nav-text">检测工具</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-过度绘制（overdraw）检测"><span class="nav-number">2.1.</span> <span class="nav-text">1.过度绘制（overdraw）检测</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-Hierarchy-Viewer工具"><span class="nav-number">2.2.</span> <span class="nav-text">2.Hierarchy Viewer工具</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#布局优化"><span class="nav-number">3.</span> <span class="nav-text">布局优化</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#一-布局的抉择"><span class="nav-number">3.1.</span> <span class="nav-text">一.布局的抉择</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#二-减少View"><span class="nav-number">3.2.</span> <span class="nav-text">二.减少View</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#三-移除不必要的背景"><span class="nav-number">3.3.</span> <span class="nav-text">三.移除不必要的背景</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#四-善于使用布局标签"><span class="nav-number">3.4.</span> <span class="nav-text">四.善于使用布局标签</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#1-include标签"><span class="nav-number">3.4.1.</span> <span class="nav-text">1.include标签</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#2-merge标签"><span class="nav-number">3.4.2.</span> <span class="nav-text">2.merge标签</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3-ViewStub标签"><span class="nav-number">3.4.3.</span> <span class="nav-text">3.ViewStub标签</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">IBigerBiger</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"ibigerbiger"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  













  
  

  

  

  

  


</body>
</html>
